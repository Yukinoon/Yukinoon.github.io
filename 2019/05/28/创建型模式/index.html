<!DOCTYPE html>
<html>
  <head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#33363b">
    <meta name="msapplication-TileColor" content="#33363b">
    
    
    
    
    <meta name="keywords" content="Life, ARIA, Hexo">
    
    
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
    
    
    <link rel="icon" type="image/png" sizes="192x192" href="/favicons/android-chrome-192x192.png">
    
    
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
    
    
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
    
    
    <link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#33363b">
    
    
    <link rel="manifest" href="/favicons/site.webmanifest">
    
    
    <meta name="msapplication-config" content="/favicons/browserconfig.xml">
    
    
    <link rel="alternate" href="/atom.xml" title="Yukinoon' s Blog" type="application/atom+xml">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="/favicons/favicon.ico">
    
    
    <link rel="stylesheet" type="text/css" href="/css/normalize.css">
    <link rel="stylesheet" type="text/css" href="/css/index.css">
    
    <link rel="stylesheet" type="text/css" href="/css/sidebar.css">
    
    
<link rel="stylesheet" type="text/css" href="/css/page.css">
<link rel="stylesheet" type="text/css" href="/css/post.css">

    <link rel="stylesheet" type="text/css" href="/css/custom.css">
    <link rel="stylesheet" type="text/css" href="/css/atom-one-dark.css">
    <link rel="stylesheet" type="text/css" href="/css/lightgallery.min.css">
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script defer type="text/javascript" src="/js/util.js"></script>
    <script defer type="text/javascript" src="/js/scrollspy.js"></script>
    <script defer type="text/javascript" src="/js/fontawesome-all.min.js"></script>
    <script defer type="text/javascript" src="/js/lightgallery.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-fullscreen.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-hash.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-pager.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-thumbnail.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-zoom.min.js"></script>
    
    
    <script defer type="text/javascript" src="/js/search.js"></script>
    <script type="text/javascript">
    $(document).ready(function () {
      var searchPath = "search.xml";
      if (searchPath.length === 0) {
        searchPath = "search.xml";
      }
      var path = "/" + searchPath;
      searchFunc(path, "search-input", "search-result");
    });
    </script>
    
    
    <script defer type="text/javascript" src="/js/index.js"></script>
    
    <script defer type="text/javascript" src="/js/custom.js"></script>
    <title>创建型模式 | Yukinoon' s Blog</title>
  </head>
  <body itemscope="" itemtype="http://schema.org/WebPage" lang="zh_CN" data-spy="scroll" data-target=".list-group">
    
<header id="header" class="header" style="background: #33363b;">
  <div class="container">
    <div class="header-container">
      <div class="header-title">
        <h1 class="title"><a href="/">Yukinoon' s Blog</a></h1>
        <h2 class="subtitle"></h2>
      </div>
      
      <div class="logo">
        <img src="/images/logo.png" alt="logo">
      </div>
      
    </div>
    <nav id="nav" class="nav">
      <a id="nav-toggle" class="nav-toggle" aria-hidden="true"><i class="fas fa-bars" aria-label="切换导航栏"></i></a>
      <ul id="menu" role="menubar" aria-hidden="false">
        
        <li role="menuitem"><a href="/">首页</a></li>
        
        <li role="menuitem"><a href="/archives/">归档</a></li>
        
        <li role="menuitem"><a href="/categories/">分类</a></li>
        
        <li role="menuitem"><a href="/tags/">标签</a></li>
        
        <li role="menuitem"><a href="/about/">关于</a></li>
        
      </ul>
    </nav>
  </div>
</header>


    <main id="main" class="main">
      <div class="container">
        <div class="main-container">
          <div class="content">
            
<div id="post" class="page">
  
  <article class="article post card" itemscope="" itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="http://www.Yukinoon.com/blog/2019/05/28/创建型模式/">
      <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
       <meta itemprop="name" content="John Doe">
       <meta itemprop="description" content="">
       <meta itemprop="image" content="/images/myavatar.png">
      </span>
      <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
       <meta itemprop="name" content="Yukinoon' s Blog">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">创建型模式</h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2019-05-28T09:34:25+08:00">2019-05-28 09:34:25</time></span>
        </span>
        
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      <p>[TOC]</p>
<h2 id="设计模式GOF23"><a href="#设计模式GOF23" class="headerlink" title="设计模式GOF23"></a>设计模式GOF23</h2><h3 id="创建型模式"><a href="#创建型模式" class="headerlink" title="创建型模式"></a>创建型模式</h3><p>用于描述“怎样创建对象”，它的主要特点是“将对象的创建与使用分离”。</p>
<p>GoF 中提供了单例、原型、工厂方法、抽象工厂、建造者等 5 种创建型模式</p>
<a id="more"></a>
<h4 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h4><p>保证一个类只有一个实例，并且提供一个访问该实例的全局访问点，常见的，windows资源管理器，文件系统，回收站、spring的bean、读取配置文件的类（没必要每次使用配置文件的时候，都去new）、数据库连接池，SpringMVC/Struts1框架中的控制器也是单例、应用程序的日志应用，是因为共享的日志文件一般在打开状态，否则不好追加。</p>
<p>• 单例模式的优点：<br>– 由于单例模式只生成一个实例，减少了系统性能开销，当一个对象的产生需要<br>比较多的资源时，如读取配置、产生其他依赖对象时，则可以通过在应用启动<br>时直接产生一个单例对象，然后永久驻留内存的方式来解决<br>– 单例模式可以在系统设置全局的访问点，优化环共享资源访问，例如可以设计<br>一个单例类，负责所有数据表的映射处理</p>
<p>• 常见的五种单例模式实现方式：<br>– 主要：<br>    • 饿汉式（线程安全，调用效率高。 但是，不能延时加载。）<br>    • 懒汉式（线程安全，调用效率不高。 但是，可以延时加载。）<br>– 其他：<br>    • 双重检测锁式（由于JVM底层内部模型原因，偶尔会出问题。不建议使用）<br>    • 静态内部类式(线程安全，调用效率高。 但是，可以延时加载)<br>    • 枚举单例(线程安全，调用效率高，不能延时加载</p>
<h5 id="饿汉式："><a href="#饿汉式：" class="headerlink" title="饿汉式："></a>饿汉式：</h5><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.singleton;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SingletonDemo1</span> </span>&#123;<br>	<br>	<span class="hljs-comment">//类初始化时，立即加载这个对象（没有延时加载的优势）。加载类时，天然的是线程安全的！</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SingletonDemo1 instance = <span class="hljs-keyword">new</span> SingletonDemo1();  <br>	<br>	<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">SingletonDemo1</span><span class="hljs-params">()</span></span>&#123;<br>	&#125;<br>	<br>	<span class="hljs-comment">//方法没有同步，调用效率高！,注意该方法一定要是static方法</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SingletonDemo1  <span class="hljs-title">getInstance</span><span class="hljs-params">()</span></span>&#123;<br>		<span class="hljs-keyword">return</span> instance;<br>	&#125;<br>	<br>&#125;<br></code></pre></td></tr></table></figure>
<p>• 饿汉式单例模式代码中，static变量会在类装载时初始化，此时也不会涉及多个线程对象访问该对象的问题。虚拟机保证只会装载一次该类，肯定不会发生并发访问的问题。因此，可以省略synchronized关键字。<br>• 问题：如果只是加载本类，而不是要调用getInstance()，甚至永远没有调用，则会造成资源浪费！</p>
<h5 id="懒汉式："><a href="#懒汉式：" class="headerlink" title="懒汉式："></a>懒汉式：</h5><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.singleton;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SingletonDemo2</span> </span>&#123;<br>	<br>	<span class="hljs-comment">//类初始化时，不初始化这个对象（延时加载，真正用的时候再创建）。</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SingletonDemo2 instance;  <br>	<br>	<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">SingletonDemo2</span><span class="hljs-params">()</span></span>&#123; <span class="hljs-comment">//私有化构造器</span><br>	&#125;<br>	<br>	<span class="hljs-comment">//方法同步，调用效率低！也需要加static</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>  <span class="hljs-keyword">synchronized</span> SingletonDemo2  <span class="hljs-title">getInstance</span><span class="hljs-params">()</span></span>&#123;<br>		<span class="hljs-keyword">if</span>(instance==<span class="hljs-keyword">null</span>)&#123;<br>			instance = <span class="hljs-keyword">new</span> SingletonDemo2();<br>		&#125;<br>		<span class="hljs-keyword">return</span> instance;<br>	&#125;<br>	<br>&#125;<br></code></pre></td></tr></table></figure>
<p>• 要点：– lazy load! 延迟加载， 懒加载！ 真正用的时候才加载！<br>• 问题：– 资源利用率高了。但是，每次调用getInstance()方法都要同步，并发效率较低</p>
<h5 id="双重检测锁模式"><a href="#双重检测锁模式" class="headerlink" title="双重检测锁模式"></a>双重检测锁模式</h5><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.singleton;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SingletonDemo03</span> </span>&#123;<br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SingletonDemo03 instance = <span class="hljs-keyword">null</span>;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SingletonDemo03 <span class="hljs-title">getInstance</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">if</span> (instance == <span class="hljs-keyword">null</span>) &#123;<br>			SingletonDemo03 sc;<br>			<span class="hljs-keyword">synchronized</span> (SingletonDemo03.class) &#123;<br>				sc = instance;<br>				<span class="hljs-keyword">if</span> (sc == <span class="hljs-keyword">null</span>) &#123;<br>					<span class="hljs-keyword">synchronized</span> (SingletonDemo03.class) &#123;<br>						<span class="hljs-keyword">if</span> (sc == <span class="hljs-keyword">null</span>) &#123;<br>							sc = <span class="hljs-keyword">new</span> SingletonDemo03();<br>						&#125;<br>					&#125;<br>					instance = sc;<br>				&#125;<br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">return</span> instance;<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">SingletonDemo03</span><span class="hljs-params">()</span> </span>&#123;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>• 这个模式将同步内容下方到if内部，提高了执行的效率不必每次获取对象时都进行同步，只有第一次才同步创建了以后就没必要了。<br>• 问题：由于编译器优化原因和JVM底层内部模型原因，偶尔会出问题。不建议使用。</p>
<h5 id="静态内部类模式"><a href="#静态内部类模式" class="headerlink" title="静态内部类模式"></a>静态内部类模式</h5><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.singleton;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SingletonDemo4</span> </span>&#123;<br>	<br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SingletonClassInstance</span> </span>&#123;<br>		<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-comment">/*final*/</span> SingletonDemo4 instance = <span class="hljs-keyword">new</span> SingletonDemo4();<br>	&#125;<br>	<br>	<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">SingletonDemo4</span><span class="hljs-params">()</span></span>&#123;<br>	&#125;<br>	<br>	<span class="hljs-comment">//方法没有同步，调用效率高！</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SingletonDemo4  <span class="hljs-title">getInstance</span><span class="hljs-params">()</span></span>&#123;<br>		<span class="hljs-keyword">return</span> SingletonClassInstance.instance;<br>	&#125;<br>	<br>&#125;<br></code></pre></td></tr></table></figure>
<p>要点：<br>– 外部类没有static属性，则不会像饿汉式那样立即加载对象。<br>– 只有真正调用getInstance(),才会加载静态内部类。加载类时是线程 安全的。 instance是static final<br>类型，保证了内存中只有这样一个实例存在，而且只能被赋值一次，从而保证了线程安全性.<br>– 兼备了并发高效调用和延迟加载的优势！</p>
<h5 id="使用枚举实现单例模式"><a href="#使用枚举实现单例模式" class="headerlink" title="使用枚举实现单例模式"></a>使用枚举实现单例模式</h5><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.singleton;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> SingletonDemo5 &#123;<br>	<br>	<span class="hljs-comment">//这个枚举元素，本身就是单例对象！</span><br>	INSTANCE;<br>	<br>	<span class="hljs-comment">//添加自己需要的操作！</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">singletonOperation</span><span class="hljs-params">()</span></span>&#123;<br>	&#125;<br>	<br>	<br>&#125;<br></code></pre></td></tr></table></figure>
<p>调用</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>    SingletonDemo05 sd = SingletonDemo05.INSTANCE;<br>    SingletonDemo05 sd2 = SingletonDemo05.INSTANCE;<br>    System.out.println(sd==sd2);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>• 优点：<br>– 实现简单<br>– 枚举本身就是单例模式。由JVM从根本上提供保障！避免通过反射和反序列化的漏洞！<br>• 缺点：<br>– 无延迟加载</p>
<h5 id="通过反射破解单例"><a href="#通过反射破解单例" class="headerlink" title="通过反射破解单例"></a>通过反射破解单例</h5><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">SingletonDemo6</span><span class="hljs-params">()</span></span>&#123; <span class="hljs-comment">//私有化构造器</span><br>        <span class="hljs-comment">//如果instance不为空就抛出异常（通过抛异常的方式）</span><br>		<span class="hljs-keyword">if</span>(instance!=<span class="hljs-keyword">null</span>)&#123;<br>			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException();<br>		&#125;<br>	&#125;<br></code></pre></td></tr></table></figure>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.singleton;<br><br><span class="hljs-keyword">import</span> java.io.ObjectStreamException;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SingletonDemo6</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;<br>	<span class="hljs-comment">//类初始化时，不初始化这个对象（延时加载，真正用的时候再创建）。</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SingletonDemo6 instance;  <br>	<br>	<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">SingletonDemo6</span><span class="hljs-params">()</span></span>&#123; <span class="hljs-comment">//私有化构造器</span><br>        <span class="hljs-comment">//如果instance不为空就抛出异常（通过抛异常的方式）</span><br>		<span class="hljs-keyword">if</span>(instance!=<span class="hljs-keyword">null</span>)&#123;<br>			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException();<br>		&#125;<br>	&#125;<br>	<br>	<span class="hljs-comment">//方法同步，调用效率低！</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>  <span class="hljs-keyword">synchronized</span> SingletonDemo6  <span class="hljs-title">getInstance</span><span class="hljs-params">()</span></span>&#123;<br>		<span class="hljs-keyword">if</span>(instance==<span class="hljs-keyword">null</span>)&#123;<br>			instance = <span class="hljs-keyword">new</span> SingletonDemo6();<br>		&#125;<br>		<span class="hljs-keyword">return</span> instance;<br>	&#125;<br>	<br>	<span class="hljs-comment">//反序列化时，如果定义了readResolve()则直接返回此方法指定的对象。而不需要单独再创建新对象！</span><br>	<span class="hljs-function"><span class="hljs-keyword">private</span> Object <span class="hljs-title">readResolve</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ObjectStreamException </span>&#123;<br>		<span class="hljs-keyword">return</span> instance;<br>	&#125;<br>	<br>&#125;<br></code></pre></td></tr></table></figure>
<p>调用</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>		<br>		Class&lt;SingletonDemo6&gt; clazz =  (Class&lt;SingletonDemo6&gt;) Class.forName(<span class="hljs-string">"com.bjsxt.singleton.SingletonDemo6"</span>);<br>		Constructor&lt;SingletonDemo6&gt; c =  clazz.getDeclaredConstructor(<span class="hljs-keyword">null</span>);<br>		<br>    	<span class="hljs-comment">//暴力访问</span><br>		c.setAccessible(<span class="hljs-keyword">true</span>);<br>		<br>		SingletonDemo6 s3  = c.newInstance();<br>		SingletonDemo6 s4  = c.newInstance();<br>		<br>		System.out.println(s3);<br>		System.out.println(s4);<br>		<br>	&#125;<br></code></pre></td></tr></table></figure>
<h5 id="通过反序列化破解单例"><a href="#通过反序列化破解单例" class="headerlink" title="通过反序列化破解单例"></a>通过反序列化破解单例</h5><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//反序列化时，如果定义了readResolve()则直接返回此方法指定的对象。而不需要单独再创建新对象！</span><br>	<span class="hljs-function"><span class="hljs-keyword">private</span> Object <span class="hljs-title">readResolve</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ObjectStreamException </span>&#123;<br>		<span class="hljs-keyword">return</span> instance;<br>	&#125;<br></code></pre></td></tr></table></figure>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.singleton;<br><br><span class="hljs-keyword">import</span> java.io.ObjectStreamException;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SingletonDemo6</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;<br>	<span class="hljs-comment">//类初始化时，不初始化这个对象（延时加载，真正用的时候再创建）。</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SingletonDemo6 instance;  <br>	<br>	<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">SingletonDemo6</span><span class="hljs-params">()</span></span>&#123; <span class="hljs-comment">//私有化构造器</span><br>        <br>	&#125;<br>	<br>	<span class="hljs-comment">//方法同步，调用效率低！</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>  <span class="hljs-keyword">synchronized</span> SingletonDemo6  <span class="hljs-title">getInstance</span><span class="hljs-params">()</span></span>&#123;<br>		<span class="hljs-keyword">if</span>(instance==<span class="hljs-keyword">null</span>)&#123;<br>			instance = <span class="hljs-keyword">new</span> SingletonDemo6();<br>		&#125;<br>		<span class="hljs-keyword">return</span> instance;<br>	&#125;<br>	<br>	<span class="hljs-comment">//反序列化时，如果定义了readResolve()则直接返回此方法指定的对象。而不需要单独再创建新对象！</span><br>	<span class="hljs-function"><span class="hljs-keyword">private</span> Object <span class="hljs-title">readResolve</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ObjectStreamException </span>&#123;<br>		<span class="hljs-keyword">return</span> instance;<br>	&#125;<br>	<br>&#125;<br></code></pre></td></tr></table></figure>
<p>调用</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.singleton;<br><br><span class="hljs-keyword">import</span> java.io.FileInputStream;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client2</span> </span>&#123;<br>	<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>		SingletonDemo6 s1 = SingletonDemo6.getInstance();<br>		SingletonDemo6 s2 = SingletonDemo6.getInstance();<br>		<br>		System.out.println(s1);<br>		System.out.println(s2);<br>		<br>		<br>		<span class="hljs-comment">//通过反序列化的方式创建多个对象</span><br>		FileOutputStream fos = <span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-string">"d:/a.txt"</span>);<br>		ObjectOutputStream oos = <span class="hljs-keyword">new</span> ObjectOutputStream(fos);<br>		oos.writeObject(s1);<br>		oos.close();<br>		fos.close();<br>		<br>		ObjectInputStream ois = <span class="hljs-keyword">new</span> ObjectInputStream(<span class="hljs-keyword">new</span> FileInputStream(<span class="hljs-string">"d:/a.txt"</span>));<br>		SingletonDemo6 s3 =  (SingletonDemo6) ois.readObject();<br>		System.out.println(s3);<br>		<br>		<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="多线程环境测试"><a href="#多线程环境测试" class="headerlink" title="多线程环境测试"></a>多线程环境测试</h5><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.singleton;<br><br><span class="hljs-keyword">import</span> java.util.concurrent.CountDownLatch;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client3</span> </span>&#123;<br>	<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>		<br>		<span class="hljs-keyword">long</span> start = System.currentTimeMillis();<br>		<span class="hljs-keyword">int</span> threadNum = <span class="hljs-number">10</span>;<br>		<br>		<span class="hljs-comment">//内部类访问外部类变量，变量要加final</span><br>		<span class="hljs-keyword">final</span> CountDownLatch  countDownLatch = <span class="hljs-keyword">new</span> CountDownLatch(threadNum);<br>		<br>		<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;threadNum;i++)&#123;<br>            <span class="hljs-comment">//new Runnable()相当于创建了一个匿名内部类</span><br>			<span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> Runnable() &#123;<br>				<span class="hljs-meta">@Override</span><br>				<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>					<br>					<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">1000000</span>;i++)&#123;<br><span class="hljs-comment">//						Object o = SingletonDemo1.getInstance();</span><br>						Object o = SingletonDemo5.INSTANCE;<br>					&#125;<br>					<br>					countDownLatch.countDown();<br>				&#125;<br>			&#125;).start();<br>		&#125;<br>		<br>		countDownLatch.await();	<span class="hljs-comment">//main线程阻塞，直到计数器变为0，才会继续往下执行！</span><br>		<br>		<span class="hljs-keyword">long</span> end = System.currentTimeMillis();<br>		System.out.println(<span class="hljs-string">"总耗时："</span>+(end-start));<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>常见的五种单例模式在多线程环境下的效率测试<br>– 大家只要关注相对值即可。在不同的环境下不同的程序测得值完全不一样</p>
<table>
<thead>
<tr>
<th>饿汉式</th>
<th>22ms</th>
</tr>
</thead>
<tbody>
<tr>
<td>懒汉式</td>
<td>636ms</td>
</tr>
<tr>
<td>静态内部类式</td>
<td>28ms</td>
</tr>
<tr>
<td>枚举式</td>
<td>32ms</td>
</tr>
<tr>
<td>双重检查锁式</td>
<td>65ms</td>
</tr>
</tbody>
</table>
<p> 常见的五种单例模式实现方式<br>– 主要：<br>• 饿汉式（线程安全，调用效率高。 但是，不能延时加载。）<br>• 懒汉式（线程安全，调用效率不高。 但是，可以延时加载。）<br>– 其他：<br>• 双重检测锁式（由于JVM底层内部模型原因，偶尔会出问题。不建议使用）<br>• 静态内部类式(线程安全，调用效率高。 但是，可以延时加载)<br>• 枚举式(线程安全，调用效率高，不能延时加载。并且可以天然的防止反射和反序列化漏洞！)<br>• 如何选用?<br>– 单例对象 占用 资源 少，不需要 延时加载：<br>• 枚举式 好于 饿汉式<br>– 单例对象 占用 资源 大，需要 延时加载：<br>• 静态内部类式 好于 懒汉式</p>
<h4 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h4><p>– 实现了创建者和调用者的分离。<br>– 详细分类：<br>• 简单工厂模式<br>• 工厂方法模式<br>• 抽象工厂模式</p>
<h5 id="面向对象设计的基本原则："><a href="#面向对象设计的基本原则：" class="headerlink" title="面向对象设计的基本原则："></a>面向对象设计的基本原则：</h5><p>OCP（开闭原则，Open-Closed Principle）：一个软件的实体应当对扩展开放，对修改关闭。<br>DIP（依赖倒转原则，Dependence Inversion Principle）：要针对接口编程，不要针对实现编程。<br>LoD（迪米特法则，Law of Demeter）：只与你直接的朋友通信，而避免和陌生人通信。</p>
<h5 id="简单工厂模式"><a href="#简单工厂模式" class="headerlink" title="简单工厂模式"></a>简单工厂模式</h5><p>Car.java</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.factory.simplefactory;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Car</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>Audi.java</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.factory.simplefactory;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Audi</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Car</span> </span>&#123;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>		System.out.println(<span class="hljs-string">"奥迪在跑"</span>);<br>	&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>Byd.java</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.factory.simplefactory;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Byd</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Car</span> </span>&#123;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>		System.out.println(<span class="hljs-string">"比亚迪在跑"</span>);<br>	&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>CarFactory.java</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.factory.simplefactory;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CarFactory</span> </span>&#123;<br>	<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>  Car <span class="hljs-title">createCar</span><span class="hljs-params">(String type)</span></span>&#123;<br>		<span class="hljs-keyword">if</span>(<span class="hljs-string">"奥迪"</span>.equals(type))&#123;<br>			<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Audi();<br>		&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">"比亚迪"</span>.equals(type))&#123;<br>			<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Byd();<br>		&#125;<span class="hljs-keyword">else</span>&#123;<br>			<span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>		&#125;<br>	&#125;<br>	<br>&#125;<br></code></pre></td></tr></table></figure>
<p>静态工厂CarFactory2.java</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.factory.simplefactory;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CarFactory2</span> </span>&#123;<br>	<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>  Car <span class="hljs-title">createAudi</span><span class="hljs-params">()</span></span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Audi();<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>  Car <span class="hljs-title">createByd</span><span class="hljs-params">()</span></span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Byd();<br>	&#125;<br>	<br>&#125;<br></code></pre></td></tr></table></figure>
<p>Client02.java</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.factory.simplefactory;<br><br><span class="hljs-comment">/**<br> * 简单工厂情况下<br> * <span class="hljs-doctag">@author</span> 尚学堂高淇 www.sxt.cn<br> *<br> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client02</span> </span>&#123;   <span class="hljs-comment">//调用者</span><br>	<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		Car c1 =CarFactory.createCar(<span class="hljs-string">"奥迪"</span>);<br>		Car c2 = CarFactory.createCar(<span class="hljs-string">"比亚迪"</span>);<br>		<br>		c1.run();<br>		c2.run();<br>		<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="工厂方法模式"><a href="#工厂方法模式" class="headerlink" title="工厂方法模式"></a>工厂方法模式</h5><p>– 为了避免简单工厂模式的缺点，不完全满足OCP。<br>– 工厂方法模式和简单工厂模式最大的不同在于，简单工厂模式只有一个（对于一个项目或者一个独立模块而言）工厂类，而工厂方法模式有一组实现了相同接口的工厂类。</p>
<p>Car.java</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.factory.factorymethod;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Car</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>Audi.java</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.factory.factorymethod;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Audi</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Car</span> </span>&#123;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>		System.out.println(<span class="hljs-string">"奥迪在跑"</span>);<br>	&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>工厂接口</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.factory.factorymethod;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CarFactory</span> </span>&#123;<br>	<span class="hljs-function">Car <span class="hljs-title">createCar</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>工厂AudiFactory.java</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.factory.factorymethod;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AudiFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CarFactory</span> </span>&#123;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> Car <span class="hljs-title">createCar</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Audi();<br>	&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>调用Client.java</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.factory.factorymethod;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		Car c1 = <span class="hljs-keyword">new</span> AudiFactory().createCar();<br>		Car c2 = <span class="hljs-keyword">new</span> BydFactory().createCar();<br>		<br>		c1.run();<br>		c2.run();<br>		<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>• 简单工厂模式和工厂方法模式PK:<br>– 结构复杂度<br>从这个角度比较，显然简单工厂模式要占优。简单工厂模式只需一个工厂类，而工厂方法模式的工厂类随着产品类个数增加而增加，这无疑会使类的个数越来越多，从而增加了结构的复杂程度。<br>– 代码复杂度<br>代码复杂度和结构复杂度是一对矛盾，既然简单工厂模式在结构方面相对简洁，那么它在代码方面肯定是比工厂方法模式复杂的了。简单工厂模式的工厂类随着产品类的增加需要增加很多方法（或代码），而工厂方法模式每个具体工厂类只完成单一任务，代码简洁。<br>– 客户端编程难度<br>工厂方法模式虽然在工厂类结构中引入了接口从而满足了OCP，但是在客户端编码中需要对工厂类进行实例化。而简单工厂模式的工厂类是个静态类，在客户端无需实例化，这无疑是个吸引人的优点。<br>– 管理上的难度这是个关键的问题。我们先谈扩展。众所周知，工厂方法模式完全满足OCP，即它有非常良好的扩展性。那是否就说明了简单工厂模式就没有扩展性呢？答案是否定的。简单工厂模式同样具备良好的扩展性——扩展的时候仅需要修改少量的代码（修改工厂类的代码）就可以满足扩展性的要求了。尽管这没有完全满足OCP，但我们不需要太拘泥于设计理论，要知道，sun提供的java官方工具包中也有想到多没有满足OCP的例子啊。然后我们从维护性的角度分析下。假如某个具体产品类需要进行一定的修改，很可能需要修改对应的工厂类。当同时需要修改多个产品类的时候，对工厂类的修改会变得相当麻烦（对号入座已经是个问题了）。反而简单工厂没有这些麻烦，当多个产品类需要修改是，简单工厂模式仍然仅仅需要修改唯一的工厂类（无论怎样都能改到满足要求吧？大不了把这个类重写）。<br>• <strong>根据设计理论建议：工厂方法模式。但实际上，我们一般都用简单工厂模式。</strong></p>
<h5 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h5><p>• 抽象工厂模式<br>– 用来生产不同产品族的全部产品。（对于增加新的产品，无能为力；支持增加产品族）<br>– 抽象工厂模式是工厂方法模式的升级版本，在有多个业务品种、业务分类时，通过抽象工厂模式产生需要的对象是一种非常好的解决方式。</p>
<p>引擎：</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.factory.abstractFactory;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Engine</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span>;<br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">start</span><span class="hljs-params">()</span></span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LuxuryEngine</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Engine</span></span>&#123;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>		System.out.println(<span class="hljs-string">"转得快!"</span>);<br>	&#125;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">start</span><span class="hljs-params">()</span> </span>&#123;<br>		System.out.println(<span class="hljs-string">"启动快，可以自动启停!"</span>);<br>	&#125;<br>	<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LowEngine</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Engine</span></span>&#123;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>		System.out.println(<span class="hljs-string">"转得慢!"</span>);<br>	&#125;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">start</span><span class="hljs-params">()</span> </span>&#123;<br>		System.out.println(<span class="hljs-string">"启动慢!"</span>);<br>	&#125;<br>	<br>&#125;<br></code></pre></td></tr></table></figure>
<p>座椅：</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.factory.abstractFactory;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Seat</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">massage</span><span class="hljs-params">()</span></span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LuxurySeat</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Seat</span> </span>&#123;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">massage</span><span class="hljs-params">()</span> </span>&#123;<br>		System.out.println(<span class="hljs-string">"可以自动按摩！"</span>);<br>	&#125;<br>	<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LowSeat</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Seat</span> </span>&#123;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">massage</span><span class="hljs-params">()</span> </span>&#123;<br>		System.out.println(<span class="hljs-string">"不能按摩！"</span>);<br>	&#125;<br>	<br>&#125;<br></code></pre></td></tr></table></figure>
<p>轮胎：</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.factory.abstractFactory;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Tyre</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">revolve</span><span class="hljs-params">()</span></span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LuxuryTyre</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Tyre</span> </span>&#123;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">revolve</span><span class="hljs-params">()</span> </span>&#123;<br>		System.out.println(<span class="hljs-string">"旋转不磨损！"</span>);<br>	&#125;<br>	<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LowTyre</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Tyre</span> </span>&#123;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">revolve</span><span class="hljs-params">()</span> </span>&#123;<br>		System.out.println(<span class="hljs-string">"旋转磨损快！"</span>);<br>	&#125;<br>	<br>&#125;<br></code></pre></td></tr></table></figure>
<p>汽车工厂</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.factory.abstractFactory;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CarFactory</span> </span>&#123;<br>	<span class="hljs-function">Engine <span class="hljs-title">createEngine</span><span class="hljs-params">()</span></span>;<br>	<span class="hljs-function">Seat <span class="hljs-title">createSeat</span><span class="hljs-params">()</span></span>;<br>	<span class="hljs-function">Tyre <span class="hljs-title">createTyre</span><span class="hljs-params">()</span></span>;<br>&#125;<br><br><span class="hljs-comment">//高端汽车工厂</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LuxuryCarFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CarFactory</span> </span>&#123;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> Engine <span class="hljs-title">createEngine</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> LuxuryEngine();<br>	&#125;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> Seat <span class="hljs-title">createSeat</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> LuxurySeat();<br>	&#125;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> Tyre <span class="hljs-title">createTyre</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> LuxuryTyre();<br>	&#125;<br><br>&#125;<br><br><span class="hljs-comment">//低端汽车工厂</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LowCarFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CarFactory</span> </span>&#123;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> Engine <span class="hljs-title">createEngine</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> LowEngine();<br>	&#125;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> Seat <span class="hljs-title">createSeat</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> LowSeat();<br>	&#125;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> Tyre <span class="hljs-title">createTyre</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> LowTyre();<br>	&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>调用</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.factory.abstractFactory;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client</span> </span>&#123;<br>	<br>	<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		CarFactory carFactory = <span class="hljs-keyword">new</span> LuxuryCarFactory();<br>		Engine e = carFactory.createEngine();<br>		<br>		e.start();<br>		e.run();<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>• 工厂模式要点：<br>– 简单工厂模式(静态工厂模式)<br>• 虽然某种程度不符合设计原则，但实际使用最多。<br>– 工厂方法模式<br>• 不修改已有类的前提下，通过增加新的工厂类实现扩展。<br>– 抽象工厂模式<br>• 不可以增加产品，可以增加产品族！<br>• 应用场景<br>– JDK中Calendar的getInstance方法<br>– JDBC中Connection对象的获取<br>– Hibernate中SessionFactory创建Session<br>– spring中IOC容器创建管理bean对象<br>– XML解析时的DocumentBuilderFactory创建解析器对象<br>– 反射中Class对象的newInstance()</p>
<h4 id="建造者模式"><a href="#建造者模式" class="headerlink" title="建造者模式"></a>建造者模式</h4><p>• 场景：<br>– 我们要建造一个复杂的产品。比如：神州飞船,Iphone。这个复杂的产品的创建。有这样一个问题需要处理：<br>• 装配这些子组件是不是有个步骤问题?<br>– 实际开发中，我们所需要的对象构建时，也非常复杂，有很多步骤需要处理时。</p>
<p>• 建造模式的本质：<br>– 分离了对象子组件的单独构造(由<strong>Builder</strong>来负责)和装配(由<strong>Director</strong>负责)。 从而可以构造出复杂的对象。这个模式适用于：某个对象的构建过程复杂的情况下使用。<br>– 由于实现了构建和装配的解耦。不同的构建器，相同的装配，也可以做出不同的对象；相同的构建器，不同的装配顺序也可以做出不同的对象。也就是实现了构建算法、装配算法的解耦，实现了更好的复用</p>
<p>构建尚学堂牌神舟飞船</p>
<p><img src="https://github.com/Yukinoon/Yukinoon.github.io/blob/master/images/pageImg/TIM%E6%88%AA%E5%9B%BE20190422205729.png?raw=true" alt="建造者模式建造神舟飞船"></p>
<p>AirShip，OrbitalModule，Engine，EscapeTower</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.builder;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AirShip</span> </span>&#123;<br>	<br>	<span class="hljs-keyword">private</span> OrbitalModule orbitalModule;  <span class="hljs-comment">//轨道舱</span><br>	<span class="hljs-keyword">private</span> Engine engine; <span class="hljs-comment">//发动机</span><br>	<span class="hljs-keyword">private</span> EscapeTower escapeTower;  <span class="hljs-comment">//逃逸塔</span><br>	<br>	<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">launch</span><span class="hljs-params">()</span></span>&#123;<br>		System.out.println(<span class="hljs-string">"发射！"</span>);<br>	&#125;<br>	<br>	<br>	<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> OrbitalModule <span class="hljs-title">getOrbitalModule</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> orbitalModule;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setOrbitalModule</span><span class="hljs-params">(OrbitalModule orbitalModule)</span> </span>&#123;<br>		<span class="hljs-keyword">this</span>.orbitalModule = orbitalModule;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> Engine <span class="hljs-title">getEngine</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> engine;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setEngine</span><span class="hljs-params">(Engine engine)</span> </span>&#123;<br>		<span class="hljs-keyword">this</span>.engine = engine;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> EscapeTower <span class="hljs-title">getEscapeTower</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> escapeTower;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setEscapeTower</span><span class="hljs-params">(EscapeTower escapeTower)</span> </span>&#123;<br>		<span class="hljs-keyword">this</span>.escapeTower = escapeTower;<br>	&#125;<br>	<br>	<br>	<br>	<br>	<br>&#125;<br><br><span class="hljs-comment">//轨道舱</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrbitalModule</span></span>&#123;<br>	<span class="hljs-keyword">private</span> String name;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">OrbitalModule</span><span class="hljs-params">(String name)</span> </span>&#123;<br>		<span class="hljs-keyword">this</span>.name = name;<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> name;<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;<br>		<span class="hljs-keyword">this</span>.name = name;<br>	&#125;<br>	<br>&#125;<br><br><span class="hljs-comment">//发动机</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Engine</span> </span>&#123;<br>	<span class="hljs-keyword">private</span> String name;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Engine</span><span class="hljs-params">(String name)</span> </span>&#123;<br>		<span class="hljs-keyword">this</span>.name = name;<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> name;<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;<br>		<span class="hljs-keyword">this</span>.name = name;<br>	&#125;<br>	<br>	<br>&#125;<br><br><span class="hljs-comment">//逃逸塔</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EscapeTower</span></span>&#123;<br>	<span class="hljs-keyword">private</span> String name;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> name;<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;<br>		<span class="hljs-keyword">this</span>.name = name;<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">EscapeTower</span><span class="hljs-params">(String name)</span> </span>&#123;<br>		<span class="hljs-keyword">super</span>();<br>		<span class="hljs-keyword">this</span>.name = name;<br>	&#125;<br>	<br>&#125;<br></code></pre></td></tr></table></figure>
<p>AirShipBuilder接口（建造者）</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.builder;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">AirShipBuilder</span> </span>&#123;<br>	<span class="hljs-function">Engine <span class="hljs-title">builderEngine</span><span class="hljs-params">()</span></span>;<br>	<span class="hljs-function">OrbitalModule <span class="hljs-title">builderOrbitalModule</span><span class="hljs-params">()</span></span>;<br>	<span class="hljs-function">EscapeTower <span class="hljs-title">builderEscapeTower</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p> （装配者）</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.builder;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">AirshipDirector</span> </span>&#123;<br>	<span class="hljs-function">AirShip <span class="hljs-title">directorAirShip</span><span class="hljs-params">()</span></span>;<span class="hljs-comment">//组装飞船</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>实现类：</p>
<p>SxtAirShipBuilder</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.builder;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SxtAirShipBuilder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AirShipBuilder</span> </span>&#123;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> Engine <span class="hljs-title">builderEngine</span><span class="hljs-params">()</span> </span>&#123;<br>		System.out.println(<span class="hljs-string">"构建尚学堂牌发动机！"</span>);<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Engine(<span class="hljs-string">"尚学堂牌发动机！"</span>);<br>	&#125;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> EscapeTower <span class="hljs-title">builderEscapeTower</span><span class="hljs-params">()</span> </span>&#123;<br>		<br>		System.out.println(<span class="hljs-string">"构建逃逸塔"</span>);<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> EscapeTower(<span class="hljs-string">"尚学堂牌逃逸塔"</span>);<br>	&#125;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> OrbitalModule <span class="hljs-title">builderOrbitalModule</span><span class="hljs-params">()</span> </span>&#123;<br>		System.out.println(<span class="hljs-string">"构建轨道舱"</span>);<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> OrbitalModule(<span class="hljs-string">"尚学堂牌轨道舱"</span>);<br>	&#125;	<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>SxtAirshipDirector</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.builder;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SxtAirshipDirector</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AirshipDirector</span> </span>&#123;<br><br>	<span class="hljs-keyword">private</span> AirShipBuilder builder;<br>	<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SxtAirshipDirector</span><span class="hljs-params">(AirShipBuilder builder)</span> </span>&#123;<br>		<span class="hljs-keyword">super</span>();<br>		<span class="hljs-keyword">this</span>.builder = builder;<br>	&#125;<br><br><br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> AirShip <span class="hljs-title">directorAirShip</span><span class="hljs-params">()</span> </span>&#123;<br>		Engine e =  builder.builderEngine();<br>		EscapeTower et =builder.builderEscapeTower();<br>		OrbitalModule o = builder.builderOrbitalModule();<br>		<br>		AirShip ship = <span class="hljs-keyword">new</span> AirShip();<br>		ship.setEngine(e);<br>		ship.setEscapeTower(et);<br>		ship.setOrbitalModule(o);<br>		<br>		<span class="hljs-keyword">return</span> ship;<br>	&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>调用者Client</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.builder;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client</span> </span>&#123;<br>	<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		<br>		AirshipDirector director = <span class="hljs-keyword">new</span> SxtAirshipDirector(<span class="hljs-keyword">new</span> SxtAirShipBuilder());<br>		<br>		AirShip airShip = director.directorAirShip();<br>		<br>		System.out.println(airShip.getEngine().getName());<br>		<br>		airShip.launch();<br>		<br>	&#125;<br>	<br>&#125;<br></code></pre></td></tr></table></figure>
<p>• 开发中应用场景：<br>– StringBuilder类的append方法<br>– SQL中的PreparedStatement<br>– JDOM中，DomBuilder、SAXBuilder</p>
<h4 id="原型模式prototype"><a href="#原型模式prototype" class="headerlink" title="原型模式prototype"></a>原型模式prototype</h4><p>• 场景：<br>– 思考一下：克隆技术是怎么样的过程? 克隆羊多利大家还记得吗?<br>– javascript语言中的，继承怎么实现?那里面也有prototype，大家还记得吗?<br>• 原型模式：<br>– 通过new产生一个对象需要非常繁琐的数据准备或访问权限，则可以使用原型模式。<br>– 就是java中的克隆技术，以某个对象为原型，复制出新的对象。显然，新的对象具备原型对象的特点<br>– 优势有：效率高(直接克隆，避免了重新执行构造过程步骤) 。<br>– 克隆类似于new，但是不同于new。new创建新的对象属性采用的是默认值。克隆出的对象的属性值完全和原对象相同。并且克隆出的新对象改变不会影响原型对象。然后，再修改克隆对象的值。<br>• 原型模式实现：<br>– Cloneable接口和clone方法<br>– Prototype模式中实现起来最困难的地方就是内存复制操作，所幸在Java中提供了clone()方法替我们做了绝大部分事情。<br>• 注意用词：克隆和拷贝一回事！</p>
<h5 id="通过实现Cloneable接口实现克隆"><a href="#通过实现Cloneable接口实现克隆" class="headerlink" title="通过实现Cloneable接口实现克隆"></a>通过实现Cloneable接口实现克隆</h5><p>Sheep.java，要实现Cloneable，并重写clone()方法</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.prototype;<br><br><span class="hljs-keyword">import</span> java.util.Date;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sheep</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Cloneable</span></span>&#123; <span class="hljs-comment">//1997,英国的克隆羊，多利！</span><br>	<br>	<span class="hljs-keyword">private</span> String sname;<br>	<span class="hljs-keyword">private</span> Date birthday;<br>	<br>	<br>	<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Sheep</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">super</span>();<br>	&#125;<br>	<br>	<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Sheep</span><span class="hljs-params">(String sname, Date birthday)</span> </span>&#123;<br>		<span class="hljs-keyword">super</span>();<br>		<span class="hljs-keyword">this</span>.sname = sname;<br>		<span class="hljs-keyword">this</span>.birthday = birthday;<br>	&#125;<br><br><br><br>	<span class="hljs-meta">@Override</span><br>		<span class="hljs-function"><span class="hljs-keyword">protected</span> Object <span class="hljs-title">clone</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException </span>&#123;<br>			Object obj = <span class="hljs-keyword">super</span>.clone();	<span class="hljs-comment">//直接调用Object对象的clone()方法</span><br>			<span class="hljs-keyword">return</span> obj;<br>		&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getSname</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> sname;<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setSname</span><span class="hljs-params">(String sname)</span> </span>&#123;<br>		<span class="hljs-keyword">this</span>.sname = sname;<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> Date <span class="hljs-title">getBirthday</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> birthday;<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setBirthday</span><span class="hljs-params">(Date birthday)</span> </span>&#123;<br>		<span class="hljs-keyword">this</span>.birthday = birthday;<br>	&#125;<br>	<br>	<br>	<br>&#125;<br></code></pre></td></tr></table></figure>
<p>调用：Client（浅克隆）</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.prototype;<br><br><span class="hljs-keyword">import</span> java.util.Date;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException </span>&#123;<br>		<br>		Sheep s1 = <span class="hljs-keyword">new</span> Sheep(<span class="hljs-string">"少利"</span>,<span class="hljs-keyword">new</span> Date(<span class="hljs-number">12312321331L</span>));<br>		System.out.println(s1);<br>		System.out.println(s1.getSname());<br>		System.out.println(s1.getBirthday());<br>		<br>		<br>		Sheep s2 = (Sheep) s1.clone();<br>		s2.setSname(<span class="hljs-string">"多利"</span>);<br>		System.out.println(s2);<br>		System.out.println(s2.getSname());<br>		System.out.println(s2.getBirthday());<br>		<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>Sheep2（深克隆）</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>		<span class="hljs-function"><span class="hljs-keyword">protected</span> Object <span class="hljs-title">clone</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException </span>&#123;<br>			Object obj = <span class="hljs-keyword">super</span>.clone();	<span class="hljs-comment">//直接调用Object对象的clone()方法</span><br>			<br>			<span class="hljs-comment">//实现深克隆</span><br>			Sheep2 s = (Sheep2) obj;<br>			s.birthday = (Date) <span class="hljs-keyword">this</span>.birthday.clone();<br>			<br>			<span class="hljs-keyword">return</span> obj;<br>		&#125;<br></code></pre></td></tr></table></figure>
<h5 id="通过序列化和反序列化实现克隆"><a href="#通过序列化和反序列化实现克隆" class="headerlink" title="通过序列化和反序列化实现克隆"></a>通过序列化和反序列化实现克隆</h5><p>Sheep，实现Cloneable,Serializable接口</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.prototype;<br><br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-keyword">import</span> java.util.Date;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sheep</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Cloneable</span>,<span class="hljs-title">Serializable</span> </span>&#123;   <span class="hljs-comment">//1997,英国的克隆羊，多利！</span><br>	<span class="hljs-keyword">private</span> String sname;<br>	<span class="hljs-keyword">private</span> Date birthday;<br>	<br>	<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">protected</span> Object <span class="hljs-title">clone</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException </span>&#123;<br>		Object obj = <span class="hljs-keyword">super</span>.clone();  <span class="hljs-comment">//直接调用object对象的clone()方法！</span><br>		<span class="hljs-keyword">return</span> obj;<br>	&#125;<br><br>    <span class="hljs-comment">//带参构造，Get，Set方法省略</span><br>	<br>&#125;<br></code></pre></td></tr></table></figure>
<p>Clinet3(使用序列化和反序列化)</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.prototype;<br><br><span class="hljs-keyword">import</span> java.io.ByteArrayInputStream;<br><span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><span class="hljs-keyword">import</span> java.util.Date;<br><br><span class="hljs-comment">/**<br> * 原型模式(深复制,使用序列化和反序列化的方式实现深复制)<br> * <span class="hljs-doctag">@author</span> 尚学堂高淇www.sxt.cn<br> *<br> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client3</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException, Exception </span>&#123;<br>		Date date = <span class="hljs-keyword">new</span> Date(<span class="hljs-number">12312321331L</span>);<br>		Sheep s1 = <span class="hljs-keyword">new</span> Sheep(<span class="hljs-string">"少利"</span>,date);<br>		System.out.println(s1);<br>		System.out.println(s1.getSname());<br>		System.out.println(s1.getBirthday());<br><br>		<br><span class="hljs-comment">//		使用序列化和反序列化实现深复制</span><br>		ByteArrayOutputStream bos = <span class="hljs-keyword">new</span> ByteArrayOutputStream();<br>		ObjectOutputStream    oos = <span class="hljs-keyword">new</span> ObjectOutputStream(bos);<br>		oos.writeObject(s1);<br>		<span class="hljs-keyword">byte</span>[] bytes = bos.toByteArray();<br>		<br>		ByteArrayInputStream  bis = <span class="hljs-keyword">new</span> ByteArrayInputStream(bytes);<br>		ObjectInputStream	  ois = <span class="hljs-keyword">new</span> ObjectInputStream(bis);<br>		<br>		Sheep s2 = (Sheep) ois.readObject();   <span class="hljs-comment">//克隆好的对象！</span><br>		<br>		System.out.println(<span class="hljs-string">"修改原型对象的属性值"</span>);  <br>		date.setTime(<span class="hljs-number">23432432423L</span>);<br>		<br>		System.out.println(s1.getBirthday());<br>		<br>		s2.setSname(<span class="hljs-string">"多利"</span>);<br>		System.out.println(s2);<br>		System.out.println(s2.getSname());<br>		System.out.println(s2.getBirthday());<br>		<br>		<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="new对象和克隆效率测试对比"><a href="#new对象和克隆效率测试对比" class="headerlink" title="new对象和克隆效率测试对比"></a>new对象和克隆效率测试对比</h5><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjsxt.prototype;<br><br><span class="hljs-comment">/**<br> * 测试普通new方式创建对象和clone方式创建对象的效率差异！<br> * 如果需要短时间创建大量对象，并且new的过程比较耗时。则可以考虑使用原型模式！<br> * <span class="hljs-doctag">@author</span> 尚学堂高淇 www.sxt.cn<br> *<br> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client4</span> </span>&#123;<br>	<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testNew</span><span class="hljs-params">(<span class="hljs-keyword">int</span> size)</span></span>&#123;<br>		<span class="hljs-keyword">long</span> start = System.currentTimeMillis();<br>		<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;size;i++)&#123;<br>			Laptop t = <span class="hljs-keyword">new</span> Laptop();<br>		&#125;<br>		<span class="hljs-keyword">long</span> end = System.currentTimeMillis();<br>		System.out.println(<span class="hljs-string">"new的方式创建耗时："</span>+(end-start));<br>	&#125;<br>	<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testClone</span><span class="hljs-params">(<span class="hljs-keyword">int</span> size)</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException</span>&#123;<br>		<span class="hljs-keyword">long</span> start = System.currentTimeMillis();<br>		Laptop t = <span class="hljs-keyword">new</span> Laptop();<br>		<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;size;i++)&#123;<br>			Laptop temp = (Laptop) t.clone();<br>		&#125;<br>		<span class="hljs-keyword">long</span> end = System.currentTimeMillis();<br>		System.out.println(<span class="hljs-string">"clone的方式创建耗时："</span>+(end-start));<br>	&#125;<br>	<br>	<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;	<br>		testNew(<span class="hljs-number">1000</span>);<br>		testClone(<span class="hljs-number">1000</span>);<br>	&#125;<br>&#125;<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Laptop</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Cloneable</span> </span>&#123;  <span class="hljs-comment">//笔记本电脑</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Laptop</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">try</span> &#123;<br>			Thread.sleep(<span class="hljs-number">10</span>);  <span class="hljs-comment">//模拟创建对象耗时的过程!</span><br>		&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>			e.printStackTrace();<br>		&#125;<br>	&#125;<br>	<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">protected</span> Object <span class="hljs-title">clone</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException </span>&#123;<br>		Object obj = <span class="hljs-keyword">super</span>.clone();  <span class="hljs-comment">//直接调用object对象的clone()方法！</span><br>		<span class="hljs-keyword">return</span> obj;<br>	&#125;<br>	<br>&#125;<br></code></pre></td></tr></table></figure>
    </main>
    <footer class="post-footer">
      
    </footer>
  </article>
  
  
  <nav class="page-nav">
    <div class="page-nav-next page-nav-item">
      
      <a href="/2019/04/16/无法用SSH协议克隆Git项目/" rel="next" title="无法用SSH协议克隆Git项目"><i class="fas fa-angle-left"></i><span class="nav-title">无法用SSH协议克隆Git项目</span></a>
      
    </div>
    <div class="page-nav-prev page-nav-item">
      
      <a href="/2019/05/28/结构型模式/" rel="prev" title="结构型模式"><span class="nav-title">结构型模式</span><i class="fas fa-angle-right"></i></a>
      
    </div>
  </nav>
  
  
</div>

          </div>
          
          
          
<aside class="sidebar" id="sidebar" style="background: url(/images/background.png);">
  
  <div class="search">
    <div class="form-group">
      <i class="fas fa-search"></i><input type="search" id="search-input" name="q" results="0" placeholder="搜索" class="form-control">
    </div>
  </div>
  <div class="search-result-box" id="search-result"></div>
  
  
<div class="info sidebar-item" id="info">
  
  <img class="author-avatar" src="/images/myavatar.png" alt="John Doe">
  
  <h1 class="author-name">John Doe</h1>
  <h2 class="author-description"></h2>
  <div class="site-count">
    
    <div class="archives-count">
      <div class="site-count-title">归档</div>
      <div><a href="/archives/">14</a></div>
    </div>
    
    
    
    <span class="site-count-divider divider">|</span>
    
    <div class="categories-count">
      <div class="site-count-title">分类</div>
      <div><a href="/categories/">0</a></div>
    </div>
    
    
    
    <span class="site-count-divider divider">|</span>
    
    <div class="tags-count">
      <div class="site-count-title">标签</div>
      <div><a href="/tags/">0</a></div>
    </div>
    
  </div>
  
  <div class="rss">
    <a class="rss-link button sidebar-item" href="/atom.xml"><i class="fas fa-rss"></i>RSS</a>
  </div>
  
</div>


  <div class="sidebar-sticky">
    
    
    
    
    
    <hr>
    <div class="post-toc sidebar-item" id="toc-div">
      <div><i class="fas fa-list-ol"></i>文章目录</div>
      <div class="post-toc-content"><ol class="list-group toc"><li class="toc-item toc-level-2"><a class="list-group-item toc-link" href="#设计模式GOF23"><span class="toc-text">设计模式GOF23</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#创建型模式"><span class="toc-text">创建型模式</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#单例模式"><span class="toc-text">单例模式</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#饿汉式："><span class="toc-text">饿汉式：</span></a></li><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#懒汉式："><span class="toc-text">懒汉式：</span></a></li><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#双重检测锁模式"><span class="toc-text">双重检测锁模式</span></a></li><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#静态内部类模式"><span class="toc-text">静态内部类模式</span></a></li><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#使用枚举实现单例模式"><span class="toc-text">使用枚举实现单例模式</span></a></li><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#通过反射破解单例"><span class="toc-text">通过反射破解单例</span></a></li><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#通过反序列化破解单例"><span class="toc-text">通过反序列化破解单例</span></a></li><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#多线程环境测试"><span class="toc-text">多线程环境测试</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#工厂模式"><span class="toc-text">工厂模式</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#面向对象设计的基本原则："><span class="toc-text">面向对象设计的基本原则：</span></a></li><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#简单工厂模式"><span class="toc-text">简单工厂模式</span></a></li><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#工厂方法模式"><span class="toc-text">工厂方法模式</span></a></li><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#抽象工厂模式"><span class="toc-text">抽象工厂模式</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#建造者模式"><span class="toc-text">建造者模式</span></a></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#原型模式prototype"><span class="toc-text">原型模式prototype</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#通过实现Cloneable接口实现克隆"><span class="toc-text">通过实现Cloneable接口实现克隆</span></a></li><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#通过序列化和反序列化实现克隆"><span class="toc-text">通过序列化和反序列化实现克隆</span></a></li><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#new对象和克隆效率测试对比"><span class="toc-text">new对象和克隆效率测试对比</span></a></li></ol></li></ol></li></ol></li></ol></div>
    </div>
    
    
    
    <hr>
    <div class="social-link sidebar-item">
      <div><i class="far fa-address-card"></i>社交链接<p></p></div>
      <ul>
        
        <li><i class="fas fa-envelope"></i><a href="1021782580@qq.com" target="_blank">E-Mail</a></li>
        
        <li><i class="fab fa-github"></i><a href="https://github.com/Yukinoon" target="_blank">GitHub</a></li>
        
        <li><i class="fab fa-weibo"></i><a href="https://weibo.com/u/2301607054?is_all=1" target="_blank">Weibo</a></li>
        
      </ul>
    </div>
    
    
  </div>
</aside>


          
        </div>
      </div>
    </main>
    
<footer id="footer" class="footer" style="background: #33363b;">
  <div class="container">
    <div class="back-to-top">
      <button id="back-to-top"><i class="fas fa-angle-double-up" aria-label="回到顶部"></i></button>
    </div>
    <div class="footer-container">
      <div class="footer-left">
        <div class="copyright">
          <span class="author">John Doe</span><span class="year"><i class="far fa-copyright"></i>2019</span>
        </div>
        
      </div>
      <div class="footer-right">
        <div class="custom-info">
          
          托管于<i class="fab fa-github-alt"></i><a href="https://pages.github.com/" target="_blank">GitHub Pages</a>
          
        </div>
        <div class="powered-by">
          由 <a href="https://hexo.io/" target="_blank">Hexo</a> 强力驱动 | 主题 <a href="https://github.com/AlynxZhou/hexo-theme-aria/" target="_blank">ARIA</a>
        </div>
      </div>
    </div>
  </div>
</footer>


  </body>
</html>
